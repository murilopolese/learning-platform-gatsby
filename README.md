# Strawbees Learning Platform (Gastby)

This is a static website version of the [Strawbees Learning Platform](https://learning.strawbees.com/) built using [Gatsby](https://www.gatsbyjs.org/). This repository contains source code for **building** a stand alone, static html website that is easy to deploy in different platforms as Heroku, Github Pages or Amazon S3 buckets.

## Quick start

- Clone repository: `git clone git@github.com:murilopolese/learning-platform-gatsby.git`
- Navigate to the directory: `cd learning-platform-gatsby`
- Install dependencies: `npm install`
- Start development server: `npm run develop`
- Build website: `npm run build`
- Deploy to Github Pages:
	- Set the correct `pathPrefix` on `build-src/buildEnvironments.js`
	- `npm run deploy-gh`
- Deploy on Amazon S3:
	- Create a `.env` file with `S3_KEY`, `S3_SECRET`, `S3_BUCKET` and `S3_REGION`
	- Set the correct `pathPrefix` on `build-src/buildEnvironments.js`
	- `npm run deploy-s3`

## Content

Previous versions of this website sourced all content from markdown files. The current setup sources everything from a [Headless WordPress setup]([Strawbees Learning CMS](https://github.com/strawbees/learning-cms).

## Components

Inside the folder [`src/components`](https://github.com/murilopolese/learning-platform-gatsby/tree/develop/src/components) you will find all UI components used to build the Learning Platform. They are an adaptation of https://github.com/strawbees/learning-ui-components.

The components should be as self contained as possible, preferably not depending on nothing else then `@material-ui/core` and `react`.

## Templates

The templates in which `content` is rendered are in the [`src/templates`](https://github.com/murilopolese/learning-platform-gatsby/tree/develop/src/templates) folder and they make use of partial templates such as the header, hero and footer. You can find them at [`src/templates/partials`](https://github.com/murilopolese/learning-platform-gatsby/tree/develop/src/templates/partials).

Make sure to always refer to static images with `withPrefix` so the website can be deployed on paths that are not the root of the domain.

## Static assets

For ease to use, all the images and non-source code assets live inside the folder `static`. Once built, those images will live on the root path of the website. To make sure they will load correctly independently of the relative path of where the website is deployed, always use `withPrefix`. For example:

```jsx
import { React } from 'react'
import { withPrefix } from 'gatsby'

export default function() {
	return (
		<img src={withPrefix('/image.jpg')} alt="Example image" />
	)
}
```

You can change the path to prefix it by editing the property `pathPrefix` on `gastby-config.js`.

## Building

Gatsby offer a fancy GraphQL and Remark (markdown) way to consume content but it's more complicated than it needs to be so we do it manually. The code that loads the content files and generate the sites through the templates lives in `gastby-node.js` and `src/utils`.

Build the website with `npm run build`. It will already build with `--path-prefix`.

## Utils

### `src/utils/htmlToReact.js`

Transforms an HTML string generated by Gutenberg (Inside WordPress) on React components. Check [Headless WordPress setup]([Strawbees Learning CMS](https://github.com/strawbees/learning-cms) to see what blocks are available.

## Deploying

After building, the static website will be created inside the `public` folder (git ignored). You can manually deploy this content on a http server, making sure to build with the correct `prefixPath` in case website won't live in the root path.

We provide 2 deploy scripts in this repository, one for Github pages and to Amazon S3.

For the Github pages, update the `prefixPath` to the name of your repository. You can read more about [Gatsby and Github pages here](https://www.gatsbyjs.org/docs/how-gatsby-works-with-github-pages/). You can run `npm run deploy-gh`.

To deploy on Amazon S3 we use [@strawbees/s3-publisher](https://github.com/strawbees/s3-publisher). Create a `.env` file with `S3_KEY`, `S3_SECRET`, `S3_BUCKET` and `S3_REGION` and run `npm run deploy-s3`.

## Roadmap

Project backlog and roadmap lives on [Pivotal Tracker](https://www.pivotaltracker.com/n/projects/2422318).
